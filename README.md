# Оптимізація взаємодії між RESTful API та SQL-базами даних


## Розглянемо декілька сценаріїв
### Перший сценарій: вибірка даних користувача з пов'язаними замовленнями.
Уявимо, що ви хочете отримати список усіх замовлень конкрентного користувача. 

Поглянемо на неоптимізований та оптимізований код.

* Неоптимізований Код: Спочатку видає дані про користувача, а потім окремим запитом видає дані про всі його замовлення. Це
  вимагає двох окремих запитів до бази даних, що може бути менш ефективним у термінах продуктивності (особливо з великим обсягом).

``` js 
app.get('/user/:id/with-orders', (req, res) => {
    let userId = req.params.id;

    // у нас тут будуть два окремих запити, не дуже ефективно
    db.query(`SELECT * FROM users WHERE user_id = ${userId}`, (err, userResult) => {
        if (err) throw err;

        db.query(`SELECT * FROM orders WHERE user_id = ${userId}`, (err, ordersResult) => {
            if (err) throw err;

            res.json({ user: userResult, orders: ordersResult });
        });
    });
});
```

* Оптимізований Код: Використовує один SQL запит з JOIN, щоб отримати всю необхідну інформацію. Це зменшує кількість запитів до 
бази даних та покращує час відгуку.

``` js 
app.get('/user/:id/with-orders', (req, res) => {
    let userId = req.params.id;

    let query = `
        SELECT users.*, orders.*
        FROM users
        LEFT JOIN orders ON users.user_id = orders.user_id
        WHERE users.user_id = ?`; 
    // використовуємо тут JOIN, більш ефективний підхід і зручний результат
    
    db.query(query, [userId], (err, result) => {
        if (err) throw err;
        res.json(result);
    });
});
```

У нашому оптимізованому сценарії, ми використовуємо SQL JOIN, який дозволяє об'єднувати дані з різних таблиць в одному запиті.
Використання JOIN є ключовим для зменшення кількості окремих запитів до бази даних, тим самим підвищуючи ефективність та 
скорочуючи час відповіді сервера. Наприклад, у нашому випадку, використання LEFT JOIN дозволяє одночасно отримати інформацію про 
користувача та його замовлення, тим самим забезпечуючи більш швидке та ефективне отримання повної інформації про користувача та 
його діяльність в одному запиті.

Отже, оптимізований код не тільки ефективніше використовує ресурси бази даних, але й забезпечує кращий загальний досвід використання API,
оскільки знижує час на відповідь